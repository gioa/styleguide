<!-- iframeSandboxTemplate allows for the safe embedding of arbitrary html including scripts -->
<div class="ansiout">
<iframe
  id="<%- frameId %>"
  width="100%"
  height="0"
  frameBorder="0"
  style="overflow: hidden"
  scrolling="no"
  sandbox="allow-scripts allow-popups allow-popups-to-escape-sandbox"
  seamless="seamless"
  srcdoc="
  <link rel=stylesheet href=<%- cssUrl %>>
  <style>
    body {
      background-color: transparent;
    }
  </style>
  <base target=_blank>
  <script>
    (function() {
      var parentUri = '<%- parentUri %>';
      var originalWidth = null;
      var originalHeight = null;
      window.onerror = function(error) {
        window.parent.postMessage({
          type: 'frameJsError',
          loc: window.location.href,
          frameId: '<%- frameId %>',
          error: error,
        }, parentUri);
      };
      window.onload = function() {
        originalWidth = document.body.scrollWidth;
        originalHeight = document.body.scrollHeight;
        window.parent.postMessage({
          type: 'frameResizeEvent',
          frameId: '<%- frameId %>',
          loc: window.location.href,
          height: originalHeight,
          width: originalWidth,
        }, parentUri);
      };
      window.addEventListener('message', function(msg) {
        var origin = msg.origin || msg.originalEvent.origin;
        if (origin !== parentUri) {
          console.error('Invalid origin', origin, parentUri);
          return;
        }

        if (msg.data.type === 'frameSizedEvent') {
          var xRatio = msg.data.frameWidth / originalWidth;
          var yRatio = msg.data.frameHeight / originalHeight;
          var scaleFactor = 1.0;
          if (xRatio < 1 || yRatio < 1) {
            scaleFactor = Math.min(xRatio, yRatio);
          }
          document.body.style['transform'] = 'scale(' + scaleFactor + ')';
          document.body.style['transformOrigin'] = 'top left';
        }
      });
    })();
  </script>
  <%- htmlContent %>"></iframe>
</div>
